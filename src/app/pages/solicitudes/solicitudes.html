<div class="flex flex-col">
  <div class="flex rounded-lg mb-4 pt-2 text-gray-500 items-center justify-end">
    <div class="bg-white flex items-center rounded-lg pl-1 border border-gray-200">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
          <path
            d="M11 6C13.7614 6 16 8.23858 16 11M16.6588 16.6549L21 21M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          ></path>
        </g>
      </svg>
      <input
        placeholder="Buscar..."
        (input)="onSearchEvent($event.target.value)"
        class="rounded-e-lg outline-none px-2 py-1"
        type="text"
      />
    </div>
  </div>

  <div class="flex flex-1 rounded-t-lg border border-gray-200 overflow-hidden">
    <table id="data" class="w-full border-collapse">
      <thead class="bg-gray-150">
        <tr>
          @for (header of headers; track $index) {
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            {{ header }}
          </th>
          }
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        @for (solicitud of paginatedSolicitudes; track $index) {
        <tr class="hover:bg-gray-100">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">
            {{ solicitud.folio }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ solicitud.usuario }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ solicitud.fecha }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ solicitud.lineaCaptura }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            <span
              class="px-2 py-1 inline-flex text-xs leading-5 rounded-full border"
              [ngClass]="{
                'text-red-500 bg-red-100 border-red-500': solicitud.estado === 'Improcedente',
                'text-green-500 bg-green-100 border-green-500': solicitud.estado === 'Procedente',
                'text-yellow-500 bg-yellow-100 border-yellow-500':
                  solicitud.estado === 'En revisi√≥n',
                'text-blue-500 bg-blue-100 border-blue-500': solicitud.estado === 'Pagada',
                'text-gray-500 bg-gray-100 border-gray-500': solicitud.estado === 'Finalizada'
              }"
              >‚óè {{ solicitud.estado }}</span
            >
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm w-[300px]">
            <div class="flex gap-4">
              <button
                class="text-blue-500 font-medium bg-blue-50 px-3 py-1 rounded-lg hover:bg-blue-100 transition cursor-pointer"
                (click)="verDetalles(solicitud.folio)"
              >
                Ver detalles
              </button>
              @if (solicitud.estado === 'En revisi√≥n') {
              <button
                class="text-green-500 font-medium bg-green-50 px-3 py-1 rounded-lg hover:bg-green-100 transition cursor-pointer"
                (click)="aprobarSolicitud(solicitud.folio)"
              >
                Procedente
              </button>
              <button
                class="text-red-500 font-medium bg-red-50 px-3 py-1 rounded-lg hover:bg-red-100 transition cursor-pointer"
                (click)="cancelarSolicitud(solicitud.folio)"
              >
                Improcedente
              </button>
              } @if (solicitud.estado === 'Procedente') {
              <button
                class="text-orange-500 font-medium bg-orange-50 px-3 py-1 rounded-lg hover:bg-orange-100 transition cursor-pointer"
                (click)="verificarPago(solicitud.lineaCaptura, solicitud.folio)"
              >
                Verificar pago
              </button>
              } @if (solicitud.estado === 'Pagada') {
              <button
                class="text-gray-500 font-medium bg-gray-50 px-3 py-1 rounded-lg hover:bg-gray-100 transition cursor-pointer"
                (click)="subirDocumento(solicitud.folio)"
              >
                Subir documento
              </button>
              }
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginaci√≥n !-->
  <div
    class="flex items-center justify-between px-6 py-3 bg-gray-50 border-l border-r border-b border-gray-200 rounded-b-lg"
  >
    <div class="text-sm text-gray-500">
      Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} a
      {{ currentPage * itemsPerPage < totalItems ? currentPage * itemsPerPage : totalItems }} de
      {{ totalItems }} resultados
    </div>

    <div class="flex space-x-2">
      <button
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        class="p-1 text-blue-500 bg-blue-100 rounded-full disabled:opacity-50 cursor-pointer"
      >
        <svg width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            id="Vector"
            d="M17 12H7M7 12L11 16M7 12L11 8"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>

      @for (page of getPageNumbers(); track page) {
      <button
        (click)="goToPage(page)"
        class="px-3 py-1 text-sm rounded cursor-pointer"
        [class]="page === currentPage ? 'bg-blue-400 text-white' : 'bg-white hover:bg-blue-100'"
      >
        {{ page }}
      </button>
      }

      <button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="p-1 text-sm text-blue-500 bg-blue-100 rounded-full disabled:opacity-50 cursor-pointer"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          transform="matrix(-1, 0, 0, 1, 0, 0)"
        >
          <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
          <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
          <g id="SVGRepo_iconCarrier">
            <g id="Arrow / Arrow_Left_SM">
              <path
                id="Vector"
                d="M17 12H7M7 12L11 16M7 12L11 8"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </g>
          </g>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Componente Dialog -->
<app-dialog
  [show]="showDialog"
  [title]="dialogTitle"
  [message]="dialogMessage"
  [type]="dialogType"
  [confirmText]="dialogConfirmText"
  [cancelText]="dialogCancelText"
  [showCancel]="dialogShowCancel"
  (confirm)="onDialogConfirm()"
  (close)="closeDialog()"
>
  <div dialog-body>
    @if (dialogType === 'success') {
      <form [formGroup]="documentos" (ngSubmit)="subirDocumentos()" class="mt-4">
        <div class="space-y-4">
          <!-- Acta de matrimonio -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="actaMatrimonio">
              Acta de matrimonio <span class="text-red-500">*</span>
            </label>
            <input
              type="file"
              id="actaMatrimonio"
              formControlName="actaMatrimonio"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'actaMatrimonio')"
              class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
            />
            <p class="mt-1 text-xs text-gray-500">PDF, JPG, JPEG o PNG (M√°x. 5MB)</p>
          </div>

          <!-- Actas de nacimiento -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="actasNacimiento">
              Actas de nacimiento <span class="text-red-500">*</span>
            </label>
            <input
              type="file"
              id="actasNacimiento"
              formControlName="actasNacimiento"
              accept=".pdf,.jpg,.jpeg,.png"
              multiple
              (change)="onFileSelected($event, 'actasNacimiento')"
              class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
            />
            <p class="mt-1 text-xs text-gray-500">Selecciona m√∫ltiples archivos si es necesario</p>
          </div>

          <!-- Acuse de notificaci√≥n -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="acuseNotificacion">
              Acuse de notificaci√≥n <span class="text-red-500">*</span>
            </label>
            <input
              type="file"
              id="acuseNotificacion"
              formControlName="acuseNotificacion"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'acuseNotificacion')"
              class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
            />
            <p class="mt-1 text-xs text-gray-500">PDF, JPG, JPEG o PNG (M√°x. 5MB)</p>
          </div>

          <!-- Resoluci√≥n a cumplimentar -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="resolucionCumplimentar">
              Resoluci√≥n a cumplimentar <span class="text-red-500">*</span>
            </label>
            <input
              type="file"
              id="resolucionCumplimentar"
              formControlName="resolucionCumplimentar"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'resolucionCumplimentar')"
              class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
            />
            <p class="mt-1 text-xs text-gray-500">PDF, JPG, JPEG o PNG (M√°x. 5MB)</p>
          </div>

          <!-- Auto que la declara ejecutoria -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="autoEjecutoria">
              Auto que la declara ejecutoria <span class="text-red-500">*</span>
            </label>
            <input
              type="file"
              id="autoEjecutoria"
              formControlName="autoEjecutoria"
              accept=".pdf,.jpg,.jpeg,.png"
              (change)="onFileSelected($event, 'autoEjecutoria')"
              class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
            />
            <p class="mt-1 text-xs text-gray-500">PDF, JPG, JPEG o PNG (M√°x. 5MB)</p>
          </div>

          <!-- Mensaje de archivos seleccionados
          @if (selectedFiles.length > 0) {
            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
              <p class="text-sm font-medium text-blue-800 mb-2">üìé Archivos seleccionados:</p>
              <ul class="text-xs text-blue-700 space-y-1">
                @for (file of selectedFiles; track file.name) {
                  <li class="flex items-center gap-2">
                    <span>‚úì</span>
                    <span class="font-medium">{{ file.fieldName }}:</span>
                    <span>{{ file.name }} ({{ formatFileSize(file.size) }})</span>
                  </li>
                }
              </ul>
            </div>
          } -->
        </div>
      </form>
    }

    @if (dialogType === 'danger') {
      <form [formGroup]="motivosImprocedencia" class="mt-4">
        <div class="space-y-4">
          <!-- Motivo principal de improcedencia -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2" for="motivoPrincipal">
              Motivo de improcedencia <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <select
                id="motivoPrincipal"
                formControlName="motivoPrincipal"
                (change)="onMotivoChange($event)"
                class="custom-select block w-full px-4 py-3 text-sm text-gray-900 border border-gray-300 rounded-lg bg-white appearance-none cursor-pointer transition-all duration-200 hover:border-red-400 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 focus:shadow-md"
              >
                <option value="" disabled class="text-gray-500">Selecciona un motivo</option>
                <option value="expediente-no-cargado" class="py-2">
                  1) Expediente no cargado en Buz√≥n Electr√≥nico del Poder Judicial
                </option>
                <option value="expediente-incompleto" class="py-2">2) Expediente incompleto</option>
                <option value="incongruencia-datos" class="py-2">3) Incongruencia de datos</option>
                <option value="anotacion-realizada" class="py-2">
                  4) Anotaci√≥n que solicita ya fue realizada
                </option>
                <option value="otro" class="py-2">5) Otro</option>
              </select>
              <!-- Icono de flecha personalizado -->
              <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Submotivo para Expediente incompleto -->
          @if (motivoSeleccionado === 'expediente-incompleto') {
            <div class="pl-4 border-l-4 border-red-300 bg-red-50 p-3 rounded-r-lg animate-fadeIn">
              <label class="block text-sm font-medium text-gray-700 mb-2" for="submotivoIncompleto">
                Especifica qu√© falta <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <select
                  id="submotivoIncompleto"
                  formControlName="submotivo"
                  class="custom-select block w-full px-4 py-3 text-sm text-gray-900 border border-gray-300 rounded-lg bg-white appearance-none cursor-pointer transition-all duration-200 hover:border-red-400 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 focus:shadow-md"
                >
                  <option value="" disabled class="text-gray-500">Selecciona lo que falta</option>
                  <option value="falta-sentencia" class="py-2">Falta Sentencia</option>
                  <option value="falta-ejecutoria" class="py-2">Falta Ejecutoria</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>
              </div>
            </div>
          }

          <!-- Submotivo para Incongruencia de datos -->
          @if (motivoSeleccionado === 'incongruencia-datos') {
            <div class="pl-4 border-l-4 border-red-300 bg-red-50 p-3 rounded-r-lg animate-fadeIn">
              <label class="block text-sm font-medium text-gray-700 mb-2" for="submotivoIncongruencia">
                Especifica la incongruencia <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <select
                  id="submotivoIncongruencia"
                  formControlName="submotivo"
                  class="custom-select block w-full px-4 py-3 text-sm text-gray-900 border border-gray-300 rounded-lg bg-white appearance-none cursor-pointer transition-all duration-200 hover:border-red-400 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 focus:shadow-md"
                >
                  <option value="" disabled class="text-gray-500">Selecciona el tipo de incongruencia</option>
                  <option value="nombres-contrayentes" class="py-2">En nombres de contrayentes</option>
                  <option value="regimen-patrimonial" class="py-2">En r√©gimen patrimonial</option>
                  <option value="oficalia-no-corresponde" class="py-2">Oficial√≠a no corresponde</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>
              </div>
            </div>
          }

          <!-- Mensaje para Anotaci√≥n ya realizada -->
          @if (motivoSeleccionado === 'anotacion-realizada') {
            <div class="p-4 bg-blue-50 border border-blue-300 rounded-lg animate-fadeIn">
              <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                  <p class="text-sm font-semibold text-blue-800 mb-1">üí° Sugerencia</p>
                  <p class="text-sm text-blue-700">
                    Se sugiere solicitar certificaci√≥n del acta de matrimonio para conocer la anotaci√≥n.
                  </p>
                </div>
              </div>
            </div>
          }

          <!-- Campo de texto libre para Otro -->
          @if (motivoSeleccionado === 'otro') {
            <div class="pl-4 border-l-4 border-red-300 bg-red-50 p-3 rounded-r-lg animate-fadeIn">
              <label class="block text-sm font-medium text-gray-700 mb-2" for="otroMotivo">
                Describe el motivo <span class="text-red-500">*</span>
              </label>
              <textarea
                id="otroMotivo"
                formControlName="otroMotivo"
                rows="4"
                placeholder="Escribe aqu√≠ el motivo de improcedencia..."
                class="block w-full px-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-none"
              ></textarea>
              <p class="mt-1 text-xs text-gray-500">M√≠nimo 10 caracteres</p>
            </div>
          }
        </div>
      </form>
    }
  </div>
</app-dialog>
